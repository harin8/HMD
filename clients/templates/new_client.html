<!DOCTYPE html>
{% extends "layout.html" %}
{% block head_block %}
    {% load static %}
    <title>HMD|New Client</title>
{% endblock %}
{% block body_block %}
<div class="container-fluid">
    <div class="row">
        <div class="col-md-6 py-3 mt-2">
            <h4>New Client</h4>
        </div>
        <div class="col-md-6 py-3 mt-2 text-right" style="padding-right:20px;">
            <a style="color:white" id="backButton" href="{% url 'Client Landing' %}"><button style="width: 200px;background-color:#0277bd" class="btn btn-secondary back">Back</button></a>
        </div>
    </div>
    <form action="{% url 'Create New Client' %}">
        <div class="row">
            <div class="col-md-2">
                <label class="form-label">Select Group Name:</label>
                <select name="GroupNameForm" class="form-control" id="Group_Name_Form">
                    <option value="1" selected>ESD</option>
                    <option value="2" >RIS</option>
                    <option value="3" >VHD</option>
                    <option value="4" >PRB</option>
                    <option value="5" >OS-ESD</option>
                    <option value="6" >OS-RIS</option>
                    <option value="7" >OS-VHD</option>
                    <option value="8" >OS-PRB</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Select Client Type:</label>
                <select name="ClientTypeForm" class="form-control" id="Client_Type_Form">
                    <option value="1">COMPANY</option>
                    <option value="2">TRUST/AOP</option>
                    <option value="3">LLP</option>
                    <option value="4">FIRM</option>
                    <option value="5">IND./HUF/OTHERS</option>
                </select>
            </div>
            <div class="col-md-1">
                <br>
                <button type="submit" class="form-control btn btn-primary" id="return-new-search" style="margin-top:7px">Create</button>
            </div>
        </div>
    </form><br>
    {% if Show_Further %}
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <form role="form" name="frmNewAdd" class="form-horizontal" action="{% url 'Submit New Client' %}" method="post" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Group Name:</label>
                                        <input required style="text-transform:uppercase" type="text" value="" id="group_name" class="form-control" name="groupName" readonly>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Client Type:</label>
                                        <input required style="text-transform:uppercase" type="text" value="" id="client_type" class="form-control" name="clientType" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Client Name:</label>
                                        <input required style="text-transform:uppercase" type="text" value="" id="c_name" class="form-control" name="name">
                                    </div>
                                </div>

                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Party Name:</label>
                                        <input required style="text-transform:uppercase" type="text" value="" id="party_name" class="form-control" name="partyName">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>IT No:</label>
                                        <!--<input required type="text" onkeyup="It_no(this.value)" pattern="[0-9]*" title="Only numbers allowed" id="it_no" class="form-control" name="itNo">-->
                                        <select required id="it_no" name="itNo" class="form-control">
                                            {% for no in Available_It_No %}
                                                <option value="{{ no|safe }}">{{ no }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Audit No:</label>
                                        <!--<input required type="text" onkeyup="Audit_no(this.value)" pattern="[0-9]*" title="Only numbers allowed" id="audit_no" class="form-control" name="auditNo">-->
                                         <select id="audit_no" name="auditNo" class="form-control">
                                             <option value="0">N.A.</option>
                                            {% for no in Available_Audit_No %}
                                                <option value="{{ no|safe }}">{{ no }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Note: </label>
                                        <input type="text" id="certificate_no" class="form-control" name="certificateNo">
                                    </div>
                                </div>
                            </div><br>
                            <div class="row">
                                <div class="col-md-12">Contact Details</div>
                            </div><br>
                            <button id="add_client" class="btn btn-success">Add</button>
                            <button id="remove_client" class="btn btn-danger">Remove</button>
                            <br><br>
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Name:</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Designation:</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Contact No:</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Email:</label>
                                    </div>
                                </div>
                            </div>
                            <span id="contact_span">
                                <div class="row contacts">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <input id="co_name_list" style="text-transform:uppercase" value="" class="form-control" list="co_name" name="contactName">
                                            <datalist id="co_name">
                                                {% for data in Contact_List %}
                                                    <option value="{{ data.Name }}"></option>
                                                {% endfor %}
                                            </datalist>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <input style="text-transform:uppercase" type="text" value="" class="form-control" name="contactDesignation">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <input id="Contact_No" pattern="[0-9]*" maxlength="10" minlength="10" title="10 digits" type="text" value="" class="form-control" name="contactNo" readonly>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <input id="Contact_Email" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" type="text" class="form-control" title="Enter Valid email" name="contactEmail" readonly>
                                        </div>
                                    </div>
                                </div>
                            </span>
                            <div class="row" id="submit-button">
                                <div class="form-group col-md-3">
                                    <button type="submit" class="btn btn-success">Submit</button>&nbsp;&nbsp;
                                    <button type="reset" class="btn btn-secondary back" name="Reset" >Reset</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>

<script>
    var counter = 1;
    $('#add_client').on('click', function(e) {
        e.preventDefault();
        $('.row.contacts').last().clone().appendTo('#contact_span').find('input').val("");
        counter += 1;
    });

	$('#remove_client').on('click', function(e) {
	    e.preventDefault();
	    if(counter > 1) {
            $('.row.contacts').last().remove();
            counter -= 1;
        }
    });
    $('#co_name_list').on('change', function() {
        var contact_list = {{ Contact_List|safe }};
        for (var i=0; i<contact_list.length;i++) {
            if(this.value == contact_list[i].Name) {
                $('#Contact_No').val(contact_list[i].Contact_no);
                $('#Contact_Email').val(contact_list[i].Email);
                break;
            }
            else {
                $('#Contact_No').val('--None--');
                $('#Contact_Email').val('--None--');
            }
        }
    });
    {% if Show_Further %}
        document.getElementById('Group_Name_Form').value = {{Group_Selected}};
        document.getElementById('group_name').value = $('#Group_Name_Form option:selected').text();
        document.getElementById('Client_Type_Form').value = {{Type_Selected}};
        document.getElementById('client_type').value = $('#Client_Type_Form option:selected').text();
    {% endif %}
</script>
{% endblock %}